---
<!-- truncate -->
<!-- truncate -->
<!-- truncate -->
slug: product-tree-structure-construction
title: ä½¿ç”¨Java8æ–°ç‰¹æ€§æ„å»ºæ ‘å½¢ç»“æ„ï¼šçµæ´»çš„çˆ¶å­èŠ‚ç‚¹å…³ç³»å¤„ç†
authors: [jiguanchen]
tags: [java]
---
åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ ‘å½¢ç»“æ„å¹¿æ³›åº”ç”¨äºç»„ç»‡å’Œè¡¨ç¤ºå±‚çº§åŒ–æ•°æ®ï¼Œå¦‚æ–‡ä»¶ç›®å½•ã€èœå•å¯¼èˆªã€ç»„ç»‡æ¶æ„ç­‰ã€‚Java 8 çš„æµå¼ API å’Œå‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§ä¸ºå¤„ç†è¿™ç±»é—®é¢˜æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚ä¸‹é¢å°†åˆ†äº«å¦‚ä½•ä½¿ç”¨ Java 8 ä¸­çš„ `Function` å’Œ `BiConsumer` ç­‰æ–°ç‰¹æ€§ï¼Œæ„å»ºæ ‘å½¢ç»“æ„å¹¶å¤„ç†çˆ¶å­èŠ‚ç‚¹å…³ç³»ã€‚

### é¡¹ç›®èƒŒæ™¯

åœ¨è®¸å¤šä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ ¹æ®èŠ‚ç‚¹çš„çˆ¶å­å…³ç³»æ¥æ„å»ºä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„äº¤æ˜“ä¿¡æ¯æ¨¡å‹å¯èƒ½åŒ…å«å¤šä¸ªäº¤æ˜“èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¹‹é—´æœ‰çˆ¶å­å…³ç³»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®ç°å±‚çº§ç»“æ„ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œçµæ´»æ“ä½œã€‚

### é¡¹ç›®éœ€æ±‚

æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œå°†ä¸€ç»„æ•°æ®æ ¹æ®çˆ¶å­å…³ç³»æ„å»ºæˆæ ‘å½¢ç»“æ„ã€‚åœ¨æ ‘å½¢ç»“æ„ä¸­ï¼Œçˆ¶èŠ‚ç‚¹å°†åŒ…å«æ‰€æœ‰å­èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨ Java 8 æä¾›çš„æµå¼æ“ä½œæ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼ŒåŒæ—¶åˆ©ç”¨å‡½æ•°å¼æ¥å£ï¼Œå¦‚ `Function` å’Œ `BiConsumer`ï¼Œæ¥æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¯å¤ç”¨æ€§ã€‚

### å…³é”®æŠ€æœ¯

1. **BiConsumer**ï¼šæ¥å—ä¸¤ä¸ªå‚æ•°å¹¶è¿”å› `void`ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å¤„ç†èŠ‚ç‚¹ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œä¾‹å¦‚ä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®å­èŠ‚ç‚¹ã€‚
2. **Function**ï¼šæ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»“æœï¼Œç”¨äºä»èŠ‚ç‚¹ä¸­è·å– ID å’Œçˆ¶ IDã€‚
3. **Stream API**ï¼šé€šè¿‡æµå¼æ“ä½œå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†ï¼Œé¿å…äº†ä¼ ç»Ÿçš„åµŒå¥—å¾ªç¯æ–¹å¼ã€‚

### ä»£ç å®ç°

```java
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.function.BiConsumer;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * åŠŸèƒ½æè¿°: 
 * è¯¥ç±»ç”¨äºæ„å»ºæ ‘å½¢ç»“æ„ï¼ŒåŸºäºç»™å®šçš„æ•°æ®åˆ—è¡¨ï¼Œå°†çˆ¶å­èŠ‚ç‚¹å…³ç³»ç»„ç»‡æˆå±‚çº§åŒ–çš„æ ‘å½¢ç»“æ„ã€‚
 * é€šè¿‡ä½¿ç”¨ Java 8 æ–°ç‰¹æ€§ï¼Œå¦‚ Function å’Œ BiConsumerï¼Œçµæ´»åœ°å¤„ç†èŠ‚ç‚¹é—´çš„çˆ¶å­å…³ç³»ã€‚
 * -
 * åˆ›å»ºäºº: å­£å† è‡£
 * åˆ›å»ºæ—¶é—´: 2024/12/2 15:38
 */
public class TreeStructureTest {

    // æ¨¡æ‹Ÿçš„èŠ‚ç‚¹ç±»
    static class TradeInfo {
        private String tradeID;  // å½“å‰èŠ‚ç‚¹ID
        private String parentID; // çˆ¶èŠ‚ç‚¹ID
        private List<TradeInfo> children;  // å­èŠ‚ç‚¹åˆ—è¡¨

        public TradeInfo(String tradeID, String parentID) {
            this.tradeID = tradeID;
            this.parentID = parentID;
            this.children = new ArrayList<>();
        }

        // Getter å’Œ Setter æ–¹æ³•
        public String getTradeID() {
            return tradeID;
        }

        public void setTradeID(String tradeID) {
            this.tradeID = tradeID;
        }

        public String getParentID() {
            return parentID;
        }

        public void setParentID(String parentID) {
            this.parentID = parentID;
        }

        public List<TradeInfo> getChildren() {
            return children;
        }

        public void setChildren(List<TradeInfo> children) {
            this.children = children;
        }

        @Override
        public String toString() {
            return "TradeInfo{" +
                    "tradeID='" + tradeID + '\'' +
                    ", parentID='" + parentID + '\'' +
                    ", children=" + children +
                    '}';
        }
    }

    // æ„å»ºæ ‘å½¢ç»“æ„
    private static <T, R> List<T> buildTree(List<T> dataList, BiConsumer<T, List<T>> setChildF, Function<T, R> getIdF,
                                            Function<T, R> getParentIdF, R rootParentId) {
        if (dataList != null && !dataList.isEmpty()) {
            setChildCall(dataList, setChildF, getIdF, getParentIdF, rootParentId);
            dataList = dataList.stream()
                    .filter(t -> (rootParentId != null && rootParentId.equals(getParentIdF.apply(t)))
                            || (rootParentId == null && getParentIdF.apply(t) == null))
                    .collect(Collectors.toList());
        }
        return dataList;
    }

    // å°†å­é›†æ”¾å…¥çˆ¶çº§
    private static <T, R> List<T> setChildCall(List<T> dataList, BiConsumer<T, List<T>> setChildF, Function<T, R> getIdF,
                                               Function<T, R> getParentIdF, R parentId) {
        if (dataList == null || dataList.isEmpty()) {
            return dataList;
        }
        List<T> parentChild = dataList.stream()
                .filter(t -> parentId == null || (getParentIdF.apply(t) != null && getParentIdF.apply(t).equals(parentId)))
                .collect(Collectors.toList());

        for (T t : parentChild) {
            setChildF.accept(t, setChildCall(dataList, setChildF, getIdF, getParentIdF, getIdF.apply(t)));
        }
        return parentChild;
    }

    public static void main(String[] args) {
        // åˆ›å»ºç¤ºä¾‹æ•°æ®
        List<TradeInfo> dataList = Arrays.asList(
                new TradeInfo("1", null),
                new TradeInfo("2", "1"),
                new TradeInfo("3", "1"),
                new TradeInfo("4", "2"),
                new TradeInfo("5", "2")
        );

        // å®šä¹‰å¦‚ä½•è·å–IDå’Œçˆ¶ID
        Function<TradeInfo, String> getIdF = TradeInfo::getTradeID;
        Function<TradeInfo, String> getParentIdF = TradeInfo::getParentID;

        // å®šä¹‰å¦‚ä½•è®¾ç½®å­èŠ‚ç‚¹
        BiConsumer<TradeInfo, List<TradeInfo>> setChildF = TradeInfo::setChildren;

        // æ„å»ºæ ‘ç»“æ„
        List<TradeInfo> tree = buildTree(dataList, setChildF, getIdF, getParentIdF, null);

        // è¾“å‡ºç»“æœ
        System.out.println("æ„å»ºåçš„æ ‘å½¢ç»“æ„:");
        tree.forEach(System.out::println);
    }
}
```

### ä»£ç è§£æ

1. **TradeInfo ç±»**ï¼šå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹ç±»ï¼ŒåŒ…å« `tradeID` å’Œ `parentID`ï¼Œå¹¶é€šè¿‡ `children` åˆ—è¡¨å­˜å‚¨å­èŠ‚ç‚¹ã€‚
2. **buildTree æ–¹æ³•**ï¼šè¿™æ˜¯æ ‘å½¢ç»“æ„æ„å»ºçš„æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒé€šè¿‡é€’å½’å°†å­èŠ‚ç‚¹è®¾ç½®åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®çˆ¶èŠ‚ç‚¹ ID ç­›é€‰å‡ºè¯¥å±‚çº§çš„èŠ‚ç‚¹ã€‚
3. **setChildCall æ–¹æ³•**ï¼šè¯¥æ–¹æ³•å®ç°äº†é€’å½’çš„æ ¸å¿ƒé€»è¾‘ï¼Œé€šè¿‡ `BiConsumer` å°†å­èŠ‚ç‚¹è®¾ç½®åˆ°çˆ¶èŠ‚ç‚¹ï¼Œæ„å»ºæ ‘å½¢ç»“æ„ã€‚
4. **å‡½æ•°å¼æ¥å£**ï¼šé€šè¿‡ `Function` æ¥å£è·å–èŠ‚ç‚¹çš„ ID å’Œçˆ¶ IDï¼Œé€šè¿‡ `BiConsumer` è®¾ç½®å­èŠ‚ç‚¹ï¼Œå®ç°äº†çµæ´»çš„èŠ‚ç‚¹å…³ç³»æ“ä½œã€‚

### è¾“å‡ºç»“æœ

è¿è¡Œä»¥ä¸Šä»£ç åï¼Œè¾“å‡ºçš„æ ‘å½¢ç»“æ„å°†å±•ç¤ºå¦‚ä¸‹ï¼š

```
æ„å»ºåçš„æ ‘å½¢ç»“æ„:
TradeInfo{tradeID='1', parentID='null', children=[TradeInfo{tradeID='2', parentID='1', children=[TradeInfo{tradeID='4', parentID='2', children=[]}, TradeInfo{tradeID='5', parentID='2', children=[]}]}, TradeInfo{tradeID='3', parentID='1', children=[]}]}
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†äº¤æ˜“ä¿¡æ¯åˆ—è¡¨ç»„ç»‡æˆäº†æ ‘å½¢ç»“æ„ã€‚

### å°ç»“

é€šè¿‡ Java 8 çš„å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ ç®€æ´ã€çµæ´»åœ°å¤„ç†å¤æ‚çš„çˆ¶å­èŠ‚ç‚¹å…³ç³»ã€‚è¿™ç§æ–¹æ³•ä¸ä»…é€‚ç”¨äºæ ‘å½¢ç»“æ„çš„æ„å»ºï¼Œè¿˜èƒ½å¤Ÿå¹¿æ³›åº”ç”¨äºå…¶ä»–éœ€è¦å±‚çº§å…³ç³»çš„æ•°æ®å¤„ç†åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†æ–‡ä»¶ç›®å½•ã€ç»„ç»‡æ¶æ„ã€èœå•å±‚çº§ç­‰é—®é¢˜æ—¶ï¼Œé‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•å°†å¤§å¤§æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

> å½“ç„¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ ‘å½¢ç»“æ„å¯èƒ½ä¼šæ›´åŠ å¤æ‚ï¼Œæ¶‰åŠæ›´å¤šçš„ä¸šåŠ¡é€»è¾‘ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œè°ƒæ•´ã€‚å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ çš„å¼€å‘å·¥ä½œæä¾›ä¸€äº›å¯å‘ï¼ğŸš€

---
